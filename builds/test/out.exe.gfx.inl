// Generated with Shader Minifier 1.3.6 (https://github.com/laurentlb/Shader_Minifier/)
#ifndef SHADER_MINIFIER_IMPL
#ifndef SHADER_MINIFIER_HEADER
# define SHADER_MINIFIER_HEADER
# define VAR_backBuffer0 "v"
# define VAR_backBuffer1 "m"
# define VAR_backBuffer2 "i"
# define VAR_backBuffer3 "o"
# define VAR_outColor0 "f"
# define VAR_outColor1 "r"
# define VAR_outColor2 "u"
# define VAR_outColor3 "s"
# define VAR_waveOutPosition "a"
#endif
#else // if SHADER_MINIFIER_IMPL
// graphics_fragment_shader.i
"#version 430\n"
 "layout(binding=0) uniform sampler2D v;"
 "layout(binding=1) uniform sampler2D m;"
 "layout(binding=2) uniform sampler2D i;"
 "layout(binding=3) uniform sampler2D o;"
 "layout(location=0) uniform int a;"
 "vec2 n=vec2(1920,1080);"
 "float c=a/4.8e4;"
 "layout(location=0) out vec4 f;"
 "layout(location=1) out vec4 r;"
 "layout(location=2) out vec4 u;"
 "layout(location=3) out vec4 s;"
 "float x;"
 "int e;"
 "const float y=acos(-1.),z=2.*y,l=y*(3.-sqrt(5.));"
 "mat2 t(float v)"
 "{"
   "float m=cos(v),C=sin(v);"
   "return mat2(m,-C,C,m);"
 "}"
 "vec2 p(float v)"
 "{"
   "return vec2(cos(v),sin(v));"
 "}"
 "vec2 d(vec2 v)"
 "{"
   "float f=atan(v.y,v.x)+z-y*.5+y/32.;"
   "f=mod(f,z/32.)+y*.5-y/32.;"
   "return p(f)*length(v);"
 "}"
 "vec2 d(vec3 v,vec3 f)"
 "{"
   "f=sign(f)*pow(abs(f),vec3(1));"
   "f/=dot(vec3(1),f);"
   "return f.x*v.zy+f.y*v.xz+f.z*v.xy;"
 "}"
 "mat3 h(vec3 v)"
 "{"
   "v=normalize(v);"
   "vec3 f=vec3(0,1,0),x=normalize(cross(f,v));"
   "f=normalize(cross(v,x));"
   "return mat3(x,f,v);"
 "}"
 "vec3 w(float v)"
 "{"
   "mat3 m=v<=6500.?"
     "mat3(vec3(0,-2902.19553737832,-8257.79972789257),vec3(0,1669.58035616666,2575.28275300176),vec3(1,1.330267372335,1.89937538917113)):"
     "mat3(vec3(1745.04252983142,1216.61683614765,-8257.79972789257),vec3(-2666.34742205357,-2173.10123430822,2575.28275300176),vec3(.559953891399315,.703812031405545,1.89937538917113));"
   "return mix(clamp(vec3(m[0]/(vec3(clamp(v,1e3,4e4))+m[1])+m[2]),vec3(0),vec3(1)),vec3(1),smoothstep(1e3,0.,v));"
 "}"
 "bool d(float v,float m,out float f)"
 "{"
   "f=(x-v)/(m-v);"
   "return 0.<=f&&f<1.;"
 "}"
 "uvec3 M(uvec3 v)"
 "{"
   "v=v*1664525u+1013904223u;"
   "v.x+=v.y*v.z;"
   "v.y+=v.z*v.x;"
   "v.z+=v.x*v.y;"
   "v^=v>>16u;"
   "v.x+=v.y*v.z;"
   "v.y+=v.z*v.x;"
   "v.z+=v.x*v.y;"
   "return v;"
 "}"
 "vec3 b(vec3 v)"
 "{"
   "uvec3 m=M(floatBitsToUint(v));"
   "return vec3(m)/float(4294967295u);"
 "}"
 "vec3 B(vec2 v)"
 "{"
   "vec2 m=floor(v),C=fract(v);"
   "C=C*C*(3.-2.*C);"
   "vec3 f=mix(b(vec3(m,.12)),b(vec3(m+vec2(1,0),.12)),C.x),x=mix(b(vec3(m+vec2(0,1),.12)),b(vec3(m+vec2(1),.12)),C.x);"
   "return mix(f,x,C.y);"
 "}"
 "vec3 g(vec2 v)"
 "{"
   "const mat2 m=t(l)*2.;"
   "float x=1.;"
   "vec4 C=vec4(0);"
   "for(int f=0;f<6;f++)"
     "C+=x*vec4(B(v),1),x*=.5,v*=m;"
   "return C.xyz/C.w;"
 "}struct Material{int type;vec3 albedo;float metallic;float roughness;};"
 "float A(float v)"
 "{"
   "return v*v*(v*v)*v;"
 "}"
 "float A(float v,float x)"
 "{"
   "float m=x*v,f=v/(1.-x*x+m*m);"
   "return f*f*(1./y);"
 "}"
 "float A(float v,float x,float m)"
 "{"
   "float f=v*v;"
   "return.5/(m*sqrt(max(0.,x*x*(1.-f)+f))+x*sqrt(max(0.,m*m*(1.-f)+f)));"
 "}"
 "vec3 B(vec3 v,float x)"
 "{"
   "return v+(1.-v)*A(1.-x);"
 "}"
 "float M(float v,float x)"
 "{"
   "return 1.+(v-1.)*A(1.-x);"
 "}"
 "float A(float x,float v,float m,float f)"
 "{"
   "float C=.5+2.*x*f*f;"
   "return M(m,C)*M(v,C)*(1./y);"
 "}"
 "vec3 A(Material v,vec3 m,vec3 x,vec3 f,bool i)"
 "{"
   "vec3 y=v.albedo;"
   "float C=v.metallic,n=v.roughness,r=n*n;"
   "r=max(r,.001);"
   "vec3 e=normalize(m+x);"
   "float o=clamp(dot(f,x),0.,1.)+1e-5,z=clamp(dot(f,m),0.,1.),c=clamp(dot(m,e),0.,1.),g=A(r,clamp(dot(f,e),0.,1.)),l=A(r,o,z);"
   "vec3 s=y*(1.-C)*A(r,o,z,c);"
   "return((i?"
     "1.:"
     "g*l)*B(.04*(1.-C)+y*C,c)+s)*z;"
 "}"
 "float B(float v,float x,float m)"
 "{"
   "return max(m,min(v,x))-length(max(vec2(m-v,m-x),vec2(0)));"
 "}"
 "float M(float v,float x,float m)"
 "{"
   "return min(-m,max(v,x))+length(max(vec2(m+v,m+x),vec2(0)));"
 "}"
 "float b(float v,float x,float f)"
 "{"
   "return M(v,-x,f);"
 "}"
 "float b(vec3 v,vec3 x)"
 "{"
   "vec3 C=abs(v)-x*.5;"
   "return min(max(C.x,max(C.y,C.z)),0.)+length(max(C,0.));"
 "}"
 "float g(vec3 v,float x)"
 "{"
   "v.y-=clamp(v.y,-x*.5,x*.5);"
   "return length(v)-.02;"
 "}"
 "float g(vec3 v,float x,float m)"
 "{"
   "vec2 C=abs(vec2(length(v.xz),v.y))-vec2(m,x);"
   "return min(max(C.x,C.y),0.)+length(max(C,0.));"
 "}"
 "const vec2 C=vec2(5.7,4)*.5;"
 "vec2 D(inout vec3 v)"
 "{"
   "vec2 o=floor(v.xy/C)*C+C*.5;"
   "v.xy=mod(v.xy,C)-.5*C;"
   "return o;"
 "}"
 "float E(vec3 v)"
 "{"
   "vec2 m=D(v);"
   "if(mod(m.x,C.x*2.)<C.x)"
     "return 1e2;"
   "float f=-v.z;"
   "f=b(f,b(v,vec3(C-.2,4)),.01);"
   "vec3 x=v-vec3(0,0,.75);"
   "x.x=abs(x.x);"
   "vec2 i=C-.2;"
   "f=B(f,b(x,vec3(i,.05)),.01);"
   "vec3 r=vec3(i.x*.25-.125,i.y*.75,.1);"
   "f=b(f,b(x-vec3(r.x*.5+.05,-r.y*.1,0),r),.01);"
   "r.y*=.5;"
   "f=b(f,b(x-vec3(r.x*1.5+.15,r.y*.3,0),r),.01);"
   "f=min(f,-.01+b(v-vec3(0,-C.y*.25,.1),vec3(C.x-.2,C.y*.3,.025)));"
   "vec3 e=v-vec3(0,-C.y*.25,.1);"
   "e.x=e.x-.2*clamp(round(e.x/.2),-12,12);"
   "f=b(f,b(e,vec3(.06,C.y*.25,.05)),.01);"
   "f=min(f,-.01+b(v-vec3(0,-C.y*.1-.025,0),vec3(C.x-.2,.05,.2)));"
   "return min(f,-.01+b(v-vec3(0,-.5*(C.y-.2)-.05,0),vec3(C.x,.05,.15)));"
 "}"
 "float F(vec3 v)"
 "{"
   "vec2 m=D(v);"
   "vec3 f=b(vec3(m,0));"
   "if(mod(m.x,C.x*2.)<C.x)"
     "return 1e2;"
   "float i=smoothstep(0.,1.5,.9-v.y);"
   "vec3 r=v;"
   "r.x*=mix(1.1,1.,i);"
   "float e=f.x*z,c=x*.5+e,o=cos(e+r.x*y*7.+.5*y*cos(r.x*7.))*.05+cos(r.x*2.+c*2.+.5*y*cos(c))*.05;"
   "r-=vec3(0,0,1.+o*i);"
   "return b(r,vec3(C-.4,.01))*.5-.01;"
 "}"
 "float G(vec3 v)"
 "{"
   "vec2 m=D(v);"
   "if(mod(m.x,C.x*2.)<C.x)"
     "return v-=vec3(-C.x*.45,0,-.07),v.x=abs(v.x-.1)-.1,g(v,C.y*.51,.07);"
   "v-=vec3(1.1,-.77,-.02);"
   "vec3 f=v;"
   "float r=-.01+b(f,vec3(.4,.28,.1));"
   "vec3 x=f-vec3(-.06,0,-.1);"
   "r=b(r,g(x.xzy,.1,.1),.005);"
   "x.z-=.05;"
   "r=min(r,-.002+g(x.xzy,.02,.02));"
   "x.xy=d(x.xy);"
   "return B(r,g(x,.1,.002),.005);"
 "}"
 "float H(vec3 v)"
 "{"
   "vec2 m=D(v);"
   "vec3 f=b(vec3(m,0));"
   "if(mod(m.x,C.x*2.)<C.x)"
     "{"
       "v-=vec3(-C.x*.45,0,-.07);"
       "v.x=abs(v.x-.1)-.1;"
       "v.y=mod(v.y,1.)-.5;"
       "v.y=abs(v.y)-.06;"
       "float x=g((v-vec3(-.11,0,0)).yxz,.04,.01);"
       "return min(x,g(v,.02,.08));"
     "}"
   "return g(v-vec3(sign(f.x-.5),-.18,0),.01,.075)-.01;"
 "}"
 "float I(vec3 v)"
 "{"
   "v.y+=C.y*.2;"
   "vec3 f=v;"
   "vec2 m=D(v);"
   "if(mod(m.x,C.x*2.)>C.x)"
     "return 1e2;"
   "f=abs(fract(f*10.)-.5);"
   "float y=clamp(smoothstep(.04,.02,f.x)+smoothstep(.04,.02,f.y),0.,1.)*.002,e=-v.z+3.;"
   "const float i=C.x*.2;"
   "float z=clamp((v.x--C.x*.5-i)/(C.x*.5-i--C.x*.5-i)*C.y,min(0.,C.y),max(0.,C.y));"
   "const vec3 o=vec3(C.x,C.y*.5,3),c=vec3(C.x-.22,C.y*.5,3);"
   "float r=b(v-vec3(0,z-C.y,1.5),o);"
   "r=min(r,b(v-vec3(0,z,1.5),o));"
   "r=b(r,b(v-vec3(0,z-C.y+.11,1.61),c),.01);"
   "r=b(r,b(v-vec3(0,z+.11,1.61),c),.01);"
   "r*=i*2./sqrt(C.y*C.y+i*i*4.);"
   "const float s=i-.13;"
   "float l=-v.z+.5;"
   "l=b(l,b(vec3(abs(v.x),v.yz)-vec3(C.x*.5-i+s*.5,0,0),vec3(s,1e9,6)),.01);"
   "r=min(r,l);"
   "r=min(r,e);"
   "r-=.01;"
   "r+=y*.5*float(x<65.||75.<=x);"
   "return r;"
 "}"
 "float J(vec3 v)"
 "{"
   "vec2 m=D(v);"
   "vec3 f=b(vec3(m,0));"
   "return mod(m.x,C.x*2.)<C.x?"
     "1e2:"
     "length(v-vec3(sign(f.x-.5),-.06,0))-.1;"
 "}"
 "float K(vec3 v)"
 "{"
   "v.y-=C.y*.1;"
   "vec2 m=D(v);"
   "if(mod(m.x,C.x*2.)>C.x)"
     "return 1e2;"
   "vec3 f=v;"
   "f=vec3(abs(f.x)-C.x*.375,f.y+C.y*.365,f.z-2.85);"
   "f.zy*=t(.3);"
   "f.xy*=t(.65);"
   "return g(f,C.x*.2);"
 "}"
 "void D(float v,inout float x,inout int f)"
 "{"
   "if(v<x)"
     "x=v,e=f;"
   "f++;"
 "}"
 "float L(vec3 v)"
 "{"
   "int f=0;"
   "e=-1;"
   "float x=1e2;"
   "D(J(v),x,f);"
   "D(K(v),x,f);"
   "D(E(v),x,f);"
   "D(F(v),x,f);"
   "D(H(v),x,f);"
   "D(G(v),x,f);"
   "D(I(v),x,f);"
   "return x;"
 "}"
 "vec3 N(vec3 v)"
 "{"
   "const vec2 f=vec2(1,-1);"
   "int m=e;"
   "vec3 x=normalize(f.xyy*L(v+f.xyy*.001)+f.yyx*L(v+f.yyx*.001)+f.yxy*L(v+f.yxy*.001)+f.xxx*L(v+f.xxx*.001));"
   "e=m;"
   "return x;"
 "}"
 "vec3 E(vec3 v,vec3 m,vec3 x)"
 "{"
   "vec3 f=abs((floor((v+sign(m)*x)/x)+.5)*x-v)-.5*x;"
   "f=max(f,0.);"
   "f/=abs(m);"
   "return f;"
 "}"
 "vec2 F(vec3 v,vec3 m,out vec3 f)"
 "{"
   "float r=1.,x=1e2,e,i=0.;"
   "for(int o=0;o<256;o++)"
     "{"
       "f=m+v*i;"
       "float c;"
       "if(d(90.,105.,c))"
         "f.z=abs(f.z)-2.;"
       "if(d(105.,120.,c))"
         "f.xz=vec2((atan(f.z,f.x)+y)/z*C.x*8.,length(f.xz)),f.z-=4.;"
       "e=L(f);"
       "float s=e*e/(2.*x),n=sqrt(e*e-s*s);"
       "r=min(r,n/(.02*max(0.,i-s)));"
       "x=e;"
       "vec3 l=E(f,v,vec3(C,1000));"
       "l+=f.z<-2.?"
         "1e9:"
         "0.;"
       "e=min(e,l.x+.001);"
       "e=min(e,l.y+.001);"
       "i+=e;"
       "if(e<.001)"
         "return vec2(1,.1);"
       "if(i>1e2)"
         "return vec2(0,max(r,.1));"
     "}"
   "return vec2(0,max(r,.1));"
 "}"
 "Material D(vec3 v,inout vec3 f)"
 "{"
   "Material r=Material(0,vec3(1),.5,.5);"
   "vec2 m=d(v,f);"
   "vec3 x=g(m*3.*vec2(3,1)),C=g(m*96.*vec2(2,1));"
   "r.albedo=vec3(clamp(1.3*mix(.6,1.,x.y)*mix(.8,1.,pow(C.x,3.)),0.,1.));"
   "r.roughness=mix(.5,1.,pow(x.y,3.));"
   "r.metallic=.01;"
   "f=normalize(f+(x*2.-1.)*.05);"
   "return r;"
 "}"
 "Material E(vec3 v,Material f)"
 "{"
   "vec2 m=D(v);"
   "vec3 C=b(vec3(m.xx,3.2));"
   "float x=C.x;"
   "f.albedo=x<.7?"
     "vec3(.8,.7,.6):"
     "x<.8?"
       "vec3(.8,.2,.2):"
       "x<.9?"
         "vec3(.8,.6,.3):"
         "vec3(.5,.7,.8);"
   "f.roughness=.99;"
   "f.metallic=.01;"
   "return f;"
 "}"
 "Material F(vec3 v,Material f)"
 "{"
   "f.metallic=.9;"
   "return f;"
 "}"
 "Material G(vec3 v,Material f)"
 "{"
   "f.albedo*=vec3(1.5);"
   "f.roughness*=.3;"
   "f.metallic=.2;"
   "return f;"
 "}"
 "Material H(vec3 v,inout vec3 f)"
 "{"
   "Material r=Material(0,vec3(1),.5,.5);"
   "if(e>1)"
     "r=D(v,f);"
   "if(e==0)"
     "{"
       "r.type=1;"
       "vec3 m=b(vec3(-.9,D(v))),C=mix(.2,1.,float(m.y<.9))*w(mix(2e3,1.5e4,m.x));"
       "r.albedo=C;"
     "}"
   "else if(e==1)"
     "{"
       "r.type=1;"
       "vec3 m=b(vec3(floor(x*10.),D(v))),C=w(1.2e4)*2.*(float(m.x<.95)*.5+.5);"
       "r.albedo=C;"
     "}"
   "else if(e==3)"
     "r=E(v,r);"
   "else if(e==4)"
     "r=F(v,r);"
   "else if(e==5)"
     "r=G(v,r);"
   "return r;"
 "}"
 "vec3 O=normalize(vec3(1,1,-1)),P=w(1.2e4);"
 "vec3 B(Material v,vec3 x,vec3 f,vec3 m)"
 "{"
   "return A(v,O,f,m,false)*P;"
 "}"
 "vec3 Q(vec3 v)"
 "{"
   "vec2 f=vec2(atan(v.x,-v.z),acos(v.y)*2.)/z*20.+vec2(.05,.01)*x;"
   "vec3 m=vec3(mix(.1,.5,g(f).x)),r=mix(vec3(.01),m,clamp((v.y+.5)*.5,0.,1.));"
   "float C=clamp(dot(v,O),0.,1.);"
   "C=smoothstep(.8,1.,C);"
   "r*=mix(1.,3.,C);"
   "r=mix(r,vec3(1),pow(min(max((C*C-.995)/.005,0.),1.),5.));"
   "r*=min(max((v.y-1.)/-.1,0.),1.);"
   "return r;"
 "}"
 "vec3 D(Material v,vec3 f,vec3 x,vec3 m)"
 "{"
   "vec3 r=vec3(0);"
   "const vec2 C=vec2(1,-1);"
   "vec3 i=-normalize(C.xyy*J(f+C.xyy*.001)+C.yyx*J(f+C.yyx*.001)+C.yxy*J(f+C.yxy*.001)+C.xxx*J(f+C.xxx*.001));"
   "float y=max(0.,J(f)-1.);"
   "vec3 c=m;"
   "e=0;"
   "Material n=H(f,c);"
   "vec3 o=n.albedo*pow(1./(1.+y),2.);"
   "r+=A(v,i,x,m,false)*o;"
   "i=-normalize(C.xyy*K(f+C.xyy*.001)+C.yyx*K(f+C.yyx*.001)+C.yxy*K(f+C.yxy*.001)+C.xxx*K(f+C.xxx*.001));"
   "y=max(0.,K(f));"
   "c=m;"
   "e=1;"
   "n=H(f,c);"
   "o=n.albedo*pow(1./(1.+y),2.);"
   "r+=A(v,i,x,m,false)*o;"
   "return r;"
 "}"
 "vec3 G(vec3 v,vec3 f,vec3 x)"
 "{"
   "Material m=H(v,x);"
   "if(m.type==1)"
     "return m.albedo;"
   "vec3 r=vec3(0);"
   "r+=B(m,v,f,x);"
   "r+=D(m,v,f,x);"
   "return r;"
 "}"
 "float I(vec3 v,vec3 x)"
 "{"
   "float f=clamp(L(v+x*.05)/.05,0.,1.);"
   "return sqrt(f);"
 "}"
 "vec3 H(inout vec3 v,vec3 f,vec3 x)"
 "{"
   "Material m=H(v,x);"
   "if(m.type==1)"
     "return m.albedo;"
   "v+=x*.001*2.;"
   "vec3 C;"
   "vec2 r=F(O,v,C);"
   "float i=r.y;"
   "vec3 e=vec3(0);"
   "e+=i*B(m,v,f,x);"
   "e+=D(m,v,f,x);"
   "float n=I(v,x);"
   "e*=n;"
   "vec3 c,z=reflect(-f,x),o=v;"
   "bool s=F(z,o,c).x>.5;"
   "vec3 l=N(c);"
   "c+=l*.001*2.;"
   "vec3 a=s?"
     "G(c,-z,l):"
     "Q(z)/y;"
   "e+=i*a*A(m,z,f,x,true)*m.metallic;"
   "return e;"
 "}"
 "const vec2 R=gl_FragCoord.xy,S=n.xy,T=S/min(S.x,S.y);"
 "vec2 U=vec2(.5);"
 "void B(out vec3 v,out vec3 f,out vec3 m,out vec2 r,vec2 i)"
 "{"
   "float e=60.,o=0.;"
   "v=vec3(1);"
   "m=vec3(0,0,1);"
   "float c=0.;"
   "if(d(0.,15.,c))"
     "c=pow(c,.5),v=vec3(.2,-1.5,2.2),m=normalize(mix(vec3(.5,1.5,1),vec3(.1,.2,1),c));"
   "else if(d(15.,30.,c))"
     "c=pow(c,.5),e=mix(60.,90.,c),o=mix(0.,.4,c),v=mix(vec3(.4,-1.5,2),vec3(.35,-.5,.3),c),m=i.x<.5?"
       "(U=vec2(.25,.5),normalize(mix(vec3(-.5,-1,1),vec3(0,-1,1),c))):"
       "(U=vec2(.75,.5),normalize(mix(vec3(-.5,-1,-1),vec3(0,0,-1),c)));"
   "else if(d(30.,45.,c))"
     "v=vec3(mix(.8-C.x,-.1,c),-1,0),m=normalize(vec3(-1,-.1,.3));"
   "else if(d(45.,60.,c))"
     "m=i.x<.5?"
       "(U=vec2(.25,.5),v=vec3(mix(-.5,.2-C.x,c),-1.8,-.3),normalize(vec3(1,.2,.8))):"
       "(U=vec2(.75,.5),e=90.,v=mix(vec3(.4-C.x,-1,.7),vec3(-.2,-1.5,.7),c),normalize(vec3(-C.x*.8,-C.y*.5+.5,-1)-v));"
   "else if(d(60.,75.,c))"
     "{"
       "float s=floor(c*3.)*8.+fract(c*3.);"
       "v=vec3(0,0,-1.-s);"
       "m=vec3(0,0,1);"
     "}"
   "else if(d(77.,90.,c))"
     "{"
       "float z=20.*c;"
       "vec3 n=vec3(-C.x*.5+.3,z*C.y,0);"
       "v=n+vec3(mix(3,-3,c),-5,-3);"
       "m=normalize(n-v);"
     "}"
   "else if(d(90.,105.,c))"
     "v=vec3(-x*4.,0,0),m=normalize(vec3(-1,mix(.2,-.2,c),0));"
   "else if(d(105.,120.,c))"
     "v=vec3(0,x*2.,0),m=normalize(vec3(0,1,mix(0.,1.,c))),m.xz*=t(y*c);"
   "r=(i-U)*2.*T;"
   "vec3 n=(g(vec2(-4.2,x*.1))*2.-1.)*.05;"
   "v+=n;"
   "mat3 s=h(m);"
   "float z=1./tan(e*y/360.);"
   "z-=z*length(r)*o;"
   "vec3 l,O,b,a;"
   "l=normalize(s*vec3(r,z));"
   "O=v;"
   "b=m;"
   "a+=s*vec3(r*2.5,0)+v;"
   "f=normalize(mix(b,l,1.));"
   "v=mix(a,O,1.);"
 "}"
 "vec4 J(vec3 v,vec3 x)"
 "{"
   "vec3 f;"
   "if(F(v,x,f).x<.5)"
     "return vec4(Q(v),100);"
   "float m=length(f-x);"
   "vec3 c=N(f),r=H(f,-v,c);"
   "return vec4(r,m);"
 "}"
 "float K(float v,float x)"
 "{"
   "return abs(min(1.,x*x)*.3*(x-v)/(abs(v*(x-.3))+1e-9))*10.;"
 "}"
 "vec3 V(vec3 v)"
 "{"
   "return v*(2.51*v+.03)/(v*(2.43*v+.59)+.14);"
 "}"
 "vec3 L(vec3 v,vec3 f)"
 "{"
   "v+=b(f)*.05;"
   "v=pow(v,vec3(.8));"
   "v=V(v);"
   "v.x=smoothstep(-.025,1.025,v.x);"
   "float m=0.;"
   "if(d(0.,10.,m))"
     "v*=m*m;"
   "else if(d(14.,16.,m))"
     "v*=2.*abs(m-.5);"
   "else if(d(29.,31.,m))"
     "v*=2.*abs(m-.5);"
   "else if(d(44.,46.,m))"
     "v*=2.*abs(m-.5);"
   "else if(d(59.,61.,m))"
     "v*=2.*abs(m-.5);"
   "else if(d(74.,77.,m))"
     "v*=clamp(75.-x,0.,1.);"
   "else if(d(119.,120.,m))"
     "v*=1.-m;"
   "else if(x>=120.)"
     "v*=0.;"
   "return v;"
 "}"
 "void main()"
 "{"
   "x=c;"
   "vec2 C=R/S;"
   "C+=(b(vec3(R,x)).xy-.5)*.25/S;"
   "vec2 i;"
   "vec3 e,z,o;"
   "B(e,z,o,i,C);"
   "vec4 y=J(z,e);"
   "y.xyz=L(y.xyz,vec3(-x,4.2*C));"
   "r=max(vec4(0),y);"
   "vec4 s=vec4(0);"
   "float O=textureLod(m,U,3.).w;"
   "vec4 a=texture(m,C);"
   "float g=K(a.w,O);"
   "const float u=sqrt(float(64));"
   "for(int M=0;M<64;M++)"
     "{"
       "float d=float(M);"
       "vec2 D=C+p(d*l)*(g*sqrt(d)/u)/n;"
       "vec4 t=texture(m,D);"
       "float E=t.w;"
       "if(E>0.)"
         "{"
           "float P=K(E,O);"
           "s+=vec4(t.xyz,1)*max(.001,P);"
         "}"
     "}"
   "s.xyz/=s.w;"
   "vec4 M=texture(v,C);"
   "vec3 d=mix(s.xyz,M.xyz,.5);"
   "d=max(vec3(0),d);"
   "f=vec4(d,1);"
 "}" 
#endif

